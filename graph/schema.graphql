type Query {
	me: User!
	user(id: ID!): User
	chat(id: ID!): Chat
	chats(first: Int, after: ID): [Chat!]!
}

type Mutation {
	createChat(userIds: [ID!]!): Chat!
	postMessage(chatId: ID!, text: String!, replyTo: ID): Message!
	editMessage(id: ID!, text: String!): Message!
	deleteMessage(id: ID!): Message!
}

type Subscription {
	chatEvent(userId: ID!): ChatEvent!
}

scalar Time

type User {
	id: ID!
	name: String!
	username: String!
	email: String!
	createdAt: Time!
}

type Chat {
	id: ID!
	name: String!
	members(first: Int, after: ID): [User!]!
	messages(first: Int, after: ID, desc: Boolean): [Message!]!
	createdBy: User
	createdAt: Time!
	lastPostedAt: Time!
}

type Message {
	id: ID!
	type: MessageType!
	content: String!
	event: String!
	sender: User
	replyTo: Message
	replies: [Message!]!
	createdAt: Time!
	editedAt: Time
}

enum MessageType {
	MESSAGE
	EVENT
}

type ChatEvent {
	type: ChatEventType!
	chatId: ID!
	message: Message
}

enum ChatEventType {
	MESSAGE_POSTED
	MESSAGE_EDITED
	MESSAGE_DELETED
}
